#!/usr/bin/env python2

import os
import sys
import socket


def process_socket(command, file):
    s = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
    s.connect(file)
    s.send(command)
    s.close()


def control(commands, action):
    if action in commands:
        os.system(commands[action])
    else:
        print('Unknown command: %s' % action)


def main(player):
    if player == 'cmus':
        commands = {'play': 'cmus-remote -p',
                    'pause': 'cmus-remote -u',
                    'prev': 'cmus-remote -r',
                    'next': 'cmus-remote -n'}

    elif player == 'shellfm':
        commands = {'play': '/home/ok/.shell-fm/scripts/unix.pl "pause\n"',
                    'pause': '/home/ok/.shell-fm/scripts/unix.pl "pause\n"',
                    'next': '/home/ok/.shell-fm/scripts/unix.pl "skip\n"'}

    control(commands, sys.argv[1])

if __name__ == '__main__':
    if os.path.exists(os.environ['HOME'] + '/.cmus/socket'):
        player = 'cmus'
    elif os.path.exists(os.environ['HOME'] + '/.shell-fm/session'):
        player = 'shellfm'
    elif 'pianobar' in os.popen('ps -C pianobar').read():
        player = 'pianobar'
    else:
        print('No supported player found.')
        sys.exit()

    main(player)
